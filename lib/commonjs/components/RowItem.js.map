{"version":3,"names":["RowItem","props","propsRef","useRef","current","useDraggableFlatListContext","activeKey","activeKeyRef","useRefs","keyToIndexRef","drag","useStableCallback","itemKey","debug","console","log","renderItem","item","panGesture","enabled","extraData","longPressGesture","Gesture","LongPress","onStart","value","runOnJS","onTouchesDown","simultaneousWithExternalGesture","getIndex","get","typedMemo","Inner","rest","MemoizedInner"],"sources":["RowItem.tsx"],"sourcesContent":["import React, { useRef } from \"react\";\r\nimport { useDraggableFlatListContext } from \"../context/draggableFlatListContext\";\r\nimport { useRefs } from \"../context/refContext\";\r\nimport { useStableCallback } from \"../hooks/useStableCallback\";\r\nimport { RenderItem } from \"../types\";\r\nimport { typedMemo } from \"../utils\";\r\nimport { Gesture, LongPressGesture, PanGesture } from \"react-native-gesture-handler\";\r\nimport { SharedValue, runOnJS } from \"react-native-reanimated\";\r\n\r\ntype Props<T> = {\r\n  extraData?: any;\r\n  drag: (itemKey: string) => void;\r\n  enabled: SharedValue<boolean>;\r\n  item: T;\r\n  renderItem: RenderItem<T>;\r\n  itemKey: string;\r\n  panGesture: PanGesture;\r\n  debug?: boolean;\r\n};\r\n\r\nfunction RowItem<T>(props: Props<T>) {\r\n  const propsRef = useRef(props);\r\n  propsRef.current = props;\r\n\r\n  const { activeKey } = useDraggableFlatListContext();\r\n  const activeKeyRef = useRef(activeKey);\r\n  activeKeyRef.current = activeKey;\r\n  const { keyToIndexRef } = useRefs();\r\n\r\n  const drag = useStableCallback(() => {\r\n    const { drag, itemKey, debug } = propsRef.current;\r\n    if (activeKeyRef.current) {\r\n      // already dragging an item, noop\r\n      if (debug)\r\n        console.log(\r\n          \"## attempt to drag item while another item is already active, noop\"\r\n        );\r\n    }\r\n    drag(itemKey);\r\n  });\r\n\r\n  const { renderItem, item, itemKey, panGesture, enabled, extraData } = props;\r\n\r\n  const longPressGesture = Gesture.LongPress()\r\n    .onStart(() => {\r\n      enabled.value = true;\r\n      runOnJS(drag)();\r\n    })\r\n    .onTouchesDown(() => {\r\n      enabled.value = false;\r\n    })\r\n    .simultaneousWithExternalGesture(panGesture);\r\n\r\n  const getIndex = useStableCallback(() => {\r\n    return keyToIndexRef.current.get(itemKey);\r\n  });\r\n\r\n  return (\r\n    <MemoizedInner\r\n      isActive={activeKey === itemKey}\r\n      renderItem={renderItem}\r\n      item={item}\r\n      getIndex={getIndex}\r\n      longPressGesture={longPressGesture}\r\n      extraData={extraData}\r\n    />\r\n  );\r\n}\r\n\r\nexport default typedMemo(RowItem);\r\n\r\ntype InnerProps<T> = {\r\n  isActive: boolean;\r\n  item: T;\r\n  getIndex: () => number | undefined;\r\n  renderItem: RenderItem<T>;\r\n  longPressGesture: LongPressGesture;\r\n  extraData?: any;\r\n};\r\n\r\nfunction Inner<T>({ renderItem, extraData, ...rest }: InnerProps<T>) {\r\n  return renderItem({ ...rest }) as JSX.Element;\r\n}\r\n\r\nconst MemoizedInner = typedMemo(Inner);\r\n"],"mappings":"mRAAA,qDACA,6EACA,iDACA,6DAEA,+BACA,uEACA,8D,wlCAaA,QAASA,QAAT,CAAoBC,KAApB,CAAqC,CACnC,GAAMC,SAAQ,CAAG,GAAAC,aAAA,EAAOF,KAAP,CAAjB,CACAC,QAAQ,CAACE,OAAT,CAAmBH,KAAnB,CAFmC,0BAIb,GAAAI,qDAAA,GAJa,CAI3BC,SAJ2B,uBAI3BA,SAJ2B,CAKnC,GAAMC,aAAY,CAAG,GAAAJ,aAAA,EAAOG,SAAP,CAArB,CACAC,YAAY,CAACH,OAAb,CAAuBE,SAAvB,CANmC,aAOT,GAAAE,mBAAA,GAPS,CAO3BC,aAP2B,UAO3BA,aAP2B,CASnC,GAAMC,KAAI,CAAG,GAAAC,oCAAA,EAAkB,UAAM,uBACFT,QAAQ,CAACE,OADP,CAC3BM,IAD2B,mBAC3BA,IAD2B,CACrBE,OADqB,mBACrBA,OADqB,CACZC,KADY,mBACZA,KADY,CAEnC,GAAIN,YAAY,CAACH,OAAjB,CAA0B,CAExB,GAAIS,KAAJ,CACEC,OAAO,CAACC,GAAR,CACE,oEADF,EAGH,CACDL,IAAI,CAACE,OAAD,CAAJ,CACD,CAVY,CAAb,CATmC,GAqB3BI,WArB2B,CAqBmCf,KArBnC,CAqB3Be,UArB2B,CAqBfC,IArBe,CAqBmChB,KArBnC,CAqBfgB,IArBe,CAqBTL,OArBS,CAqBmCX,KArBnC,CAqBTW,OArBS,CAqBAM,UArBA,CAqBmCjB,KArBnC,CAqBAiB,UArBA,CAqBYC,OArBZ,CAqBmClB,KArBnC,CAqBYkB,OArBZ,CAqBqBC,SArBrB,CAqBmCnB,KArBnC,CAqBqBmB,SArBrB,CAuBnC,GAAMC,iBAAgB,CAAGC,kCAAA,CAAQC,SAAR,GACtBC,OADsB,gCACR,CACbL,OAAO,CAACM,KAAR,CAAgB,IAAhB,CACA,GAAAC,8BAAA,EAAQhB,IAAR,IACD,CAJsB,sBAzCzBS,OAyCyB,SAxCzBO,8BAwCyB,MAxCjBhB,IAwCiB,kQAKtBiB,aALsB,gCAKF,CACnBR,OAAO,CAACM,KAAR,CAAgB,KAAhB,CACD,CAPsB,sBAzCzBN,OAyCyB,sOAQtBS,+BARsB,CAQUV,UARV,CAAzB,CAUA,GAAMW,SAAQ,CAAG,GAAAlB,oCAAA,EAAkB,UAAM,CACvC,MAAOF,cAAa,CAACL,OAAd,CAAsB0B,GAAtB,CAA0BlB,OAA1B,CAAP,CACD,CAFgB,CAAjB,CAIA,MACE,8BAAC,aAAD,EACE,QAAQ,CAAEN,SAAS,GAAKM,OAD1B,CAEE,UAAU,CAAEI,UAFd,CAGE,IAAI,CAAEC,IAHR,CAIE,QAAQ,CAAEY,QAJZ,CAKE,gBAAgB,CAAER,gBALpB,CAME,SAAS,CAAED,SANb,4EADF,CAUD,C,aAEc,GAAAW,gBAAA,EAAU/B,OAAV,C,0BAWf,QAASgC,MAAT,MAAqE,IAAjDhB,WAAiD,MAAjDA,UAAiD,CAArCI,SAAqC,MAArCA,SAAqC,CAAvBa,IAAuB,wEACnE,MAAOjB,WAAU,kBAAMiB,IAAN,EAAjB,CACD,CAED,GAAMC,cAAa,CAAG,GAAAH,gBAAA,EAAUC,KAAV,CAAtB"}