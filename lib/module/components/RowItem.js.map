{"version":3,"names":["React","useRef","useDraggableFlatListContext","useRefs","useStableCallback","typedMemo","Gesture","runOnJS","RowItem","props","propsRef","current","activeKey","activeKeyRef","keyToIndexRef","drag","itemKey","debug","console","log","renderItem","item","panGesture","enabled","extraData","longPressGesture","LongPress","onStart","value","onTouchesDown","simultaneousWithExternalGesture","getIndex","get","Inner","rest","MemoizedInner"],"sources":["RowItem.tsx"],"sourcesContent":["import React, { useRef } from \"react\";\r\nimport { useDraggableFlatListContext } from \"../context/draggableFlatListContext\";\r\nimport { useRefs } from \"../context/refContext\";\r\nimport { useStableCallback } from \"../hooks/useStableCallback\";\r\nimport { RenderItem } from \"../types\";\r\nimport { typedMemo } from \"../utils\";\r\nimport { Gesture, LongPressGesture, PanGesture } from \"react-native-gesture-handler\";\r\nimport { SharedValue, runOnJS } from \"react-native-reanimated\";\r\n\r\ntype Props<T> = {\r\n  extraData?: any;\r\n  drag: (itemKey: string) => void;\r\n  enabled: SharedValue<boolean>;\r\n  item: T;\r\n  renderItem: RenderItem<T>;\r\n  itemKey: string;\r\n  panGesture: PanGesture;\r\n  debug?: boolean;\r\n};\r\n\r\nfunction RowItem<T>(props: Props<T>) {\r\n  const propsRef = useRef(props);\r\n  propsRef.current = props;\r\n\r\n  const { activeKey } = useDraggableFlatListContext();\r\n  const activeKeyRef = useRef(activeKey);\r\n  activeKeyRef.current = activeKey;\r\n  const { keyToIndexRef } = useRefs();\r\n\r\n  const drag = useStableCallback(() => {\r\n    const { drag, itemKey, debug } = propsRef.current;\r\n    if (activeKeyRef.current) {\r\n      // already dragging an item, noop\r\n      if (debug)\r\n        console.log(\r\n          \"## attempt to drag item while another item is already active, noop\"\r\n        );\r\n    }\r\n    drag(itemKey);\r\n  });\r\n\r\n  const { renderItem, item, itemKey, panGesture, enabled, extraData } = props;\r\n\r\n  const longPressGesture = Gesture.LongPress()\r\n    .onStart(() => {\r\n      enabled.value = true;\r\n      runOnJS(drag)();\r\n    })\r\n    .onTouchesDown(() => {\r\n      enabled.value = false;\r\n    })\r\n    .simultaneousWithExternalGesture(panGesture);\r\n\r\n  const getIndex = useStableCallback(() => {\r\n    return keyToIndexRef.current.get(itemKey);\r\n  });\r\n\r\n  return (\r\n    <MemoizedInner\r\n      isActive={activeKey === itemKey}\r\n      renderItem={renderItem}\r\n      item={item}\r\n      getIndex={getIndex}\r\n      longPressGesture={longPressGesture}\r\n      extraData={extraData}\r\n    />\r\n  );\r\n}\r\n\r\nexport default typedMemo(RowItem);\r\n\r\ntype InnerProps<T> = {\r\n  isActive: boolean;\r\n  item: T;\r\n  getIndex: () => number | undefined;\r\n  renderItem: RenderItem<T>;\r\n  longPressGesture: LongPressGesture;\r\n  extraData?: any;\r\n};\r\n\r\nfunction Inner<T>({ renderItem, extraData, ...rest }: InnerProps<T>) {\r\n  return renderItem({ ...rest }) as JSX.Element;\r\n}\r\n\r\nconst MemoizedInner = typedMemo(Inner);\r\n"],"mappings":"AAAA,OAAOA,KAAP,IAAgBC,MAAhB,QAA8B,OAA9B;AACA,SAASC,2BAAT,QAA4C,qCAA5C;AACA,SAASC,OAAT,QAAwB,uBAAxB;AACA,SAASC,iBAAT,QAAkC,4BAAlC;AAEA,SAASC,SAAT,QAA0B,UAA1B;AACA,SAASC,OAAT,QAAsD,8BAAtD;AACA,SAAsBC,OAAtB,QAAqC,yBAArC;;AAaA,SAASC,OAAT,CAAoBC,KAApB,EAAqC;EACnC,MAAMC,QAAQ,GAAGT,MAAM,CAACQ,KAAD,CAAvB;EACAC,QAAQ,CAACC,OAAT,GAAmBF,KAAnB;EAEA,MAAM;IAAEG;EAAF,IAAgBV,2BAA2B,EAAjD;EACA,MAAMW,YAAY,GAAGZ,MAAM,CAACW,SAAD,CAA3B;EACAC,YAAY,CAACF,OAAb,GAAuBC,SAAvB;EACA,MAAM;IAAEE;EAAF,IAAoBX,OAAO,EAAjC;EAEA,MAAMY,IAAI,GAAGX,iBAAiB,CAAC,MAAM;IACnC,MAAM;MAAEW,IAAF;MAAQC,OAAR;MAAiBC;IAAjB,IAA2BP,QAAQ,CAACC,OAA1C;;IACA,IAAIE,YAAY,CAACF,OAAjB,EAA0B;MACxB;MACA,IAAIM,KAAJ,EACEC,OAAO,CAACC,GAAR,CACE,oEADF;IAGH;;IACDJ,IAAI,CAACC,OAAD,CAAJ;EACD,CAV6B,CAA9B;EAYA,MAAM;IAAEI,UAAF;IAAcC,IAAd;IAAoBL,OAApB;IAA6BM,UAA7B;IAAyCC,OAAzC;IAAkDC;EAAlD,IAAgEf,KAAtE;EAEA,MAAMgB,gBAAgB,GAAGnB,OAAO,CAACoB,SAAR,GACtBC,OADsB,CACd,MAAM;IACbJ,OAAO,CAACK,KAAR,GAAgB,IAAhB;IACArB,OAAO,CAACQ,IAAD,CAAP;EACD,CAJsB,EAKtBc,aALsB,CAKR,MAAM;IACnBN,OAAO,CAACK,KAAR,GAAgB,KAAhB;EACD,CAPsB,EAQtBE,+BARsB,CAQUR,UARV,CAAzB;EAUA,MAAMS,QAAQ,GAAG3B,iBAAiB,CAAC,MAAM;IACvC,OAAOU,aAAa,CAACH,OAAd,CAAsBqB,GAAtB,CAA0BhB,OAA1B,CAAP;EACD,CAFiC,CAAlC;EAIA,oBACE,oBAAC,aAAD;IACE,QAAQ,EAAEJ,SAAS,KAAKI,OAD1B;IAEE,UAAU,EAAEI,UAFd;IAGE,IAAI,EAAEC,IAHR;IAIE,QAAQ,EAAEU,QAJZ;IAKE,gBAAgB,EAAEN,gBALpB;IAME,SAAS,EAAED;EANb,EADF;AAUD;;AAED,eAAenB,SAAS,CAACG,OAAD,CAAxB;;AAWA,SAASyB,KAAT,OAAqE;EAAA,IAAnD;IAAEb,UAAF;IAAcI,SAAd;IAAyB,GAAGU;EAA5B,CAAmD;EACnE,OAAOd,UAAU,CAAC,EAAE,GAAGc;EAAL,CAAD,CAAjB;AACD;;AAED,MAAMC,aAAa,GAAG9B,SAAS,CAAC4B,KAAD,CAA/B"}